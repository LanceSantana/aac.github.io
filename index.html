<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AAC Avatar</title>

<style>
  :root{
    --ink:#0e0e0e; --muted:#6b6b6b; --line:#e8e8e8;
    --sage:#7f8f73; --sage-900:#5a6a52; --sage-100:#e7efd9;
    --tab-green:#98b38c; --tab-teal:#a8c6bd; --tab-blue:#9fb4d8;
    --tab-purple:#b6a0bd; --tab-rose:#caa5a5;
    --pale: var(--sage-100); 
  }
  *{ box-sizing:border-box; }
  html,body{ margin:0; padding:0; }
  body{ font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink); background:#fff; }
  .container{ width:min(1100px,92vw); margin:0 auto; }

  /* NAV: left brand, centered links, right icon */
  .nav{
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    align-items:center;
    gap:16px;
    padding:16px 20px;
  }
  .brand{ font-weight:700; font-size:22px; text-decoration:none; color:var(--ink); justify-self:start; }
  .navlinks{ display:flex; gap:28px; align-items:center; justify-self:center; }
  .navlinks a{ color:var(--ink); text-decoration:none; font-size:14px; }
  .navlinks a:hover{ text-decoration:underline; }
  .nav-actions{ justify-self:end; }
  .avatar-btn{
    width:36px; height:36px; border-radius:50%;
    background:var(--sage); color:#fff; border:0; cursor:pointer;
    display:grid; place-items:center; font-size:16px;
  }

  /* TITLE (centered) */
  .hero{ text-align:center; margin:18px 0 30px; }
  .hero h1{ font-weight:500; font-size:clamp(26px,4.2vw,36px); margin:10px 0 0; }



  /* MAIN PANEL */
  .panel{
    background:var(--sage);
    border-radius:18px;
    padding:20px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:20px;
    box-shadow: inset 0 1px 0 rgba(0,0,0,.06);
  }
  @media (max-width: 900px){ .panel{ grid-template-columns: 1fr; } }

  .frame{ background:#24301f20; border-radius:14px; padding:12px; box-shadow: 0 2px 0 rgba(0,0,0,.12); }
  .frame{ transition: background .32s ease, color .24s ease; }
  .screen{
    width:100%; aspect-ratio:16 / 9; border-radius:12px; object-fit:cover; display:block; background:#ddd;
    box-shadow: 0 2px 0 rgba(0,0,0,.18);
  }

  /* GRID OF BUTTONS: 4√ó4 layout */
  .keys {
    display: grid;
    gap: 14px;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    grid-auto-rows: 120px;
  }
  @media (max-width: 900px) { .keys { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
  @media (max-width: 420px) { .keys { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
  .key {
    background:#d7e0cf;
    border:2px solid #c7d1bd;
    border-radius:10px;
    padding:14px 12px;
    text-align:center;
    font-weight:600;
    font-size:16px;
    box-shadow:0 1px 0 rgba(0,0,0,.08);
    cursor:pointer;
    transition: transform .12s ease, background .28s ease, border-color .28s ease, color .2s ease;
    user-select:none;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
  }
  .key:active{ transform: translateY(1px); }
  .key:hover{ background:#e2e9d9; border-color:#b8c4ad; }
  .key:focus{ outline:3px solid rgba(37,101,45,0.18); outline-offset:2px; }
  .key.folder{ background:#c7d1bd; border-color:#a8b59a; }
  .key.folder::before{ content: "üìÇ"; margin-right:8px; display:inline-block; }
  .key.back{ background:#9fb89b; border-color:#8aa783; font-weight:700; }
  .key.back::before{ content: "‚Üê"; margin-right:8px; display:inline-block; }

  /* accessible helper to announce speech status */
  .visually-hidden{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px, 1px, 1px, 1px); white-space:nowrap; }

  /* Center the container itself */
  .container { margin-left:auto; margin-right:auto; }

  /* Title: center the block, not just the text */
  .hero { display:grid; place-items:center; width:100%; }  /* full row, grid centers */
  .hero h1 { margin:0; justify-self:center; text-align:center; }

  /* Footer: same idea */
  .footer-note { display:grid; place-items:center; text-align:center; width:100%; }

  h3{ margin:0 0 10px; font-size:20px; }

  /* FOOTER (centered, two lines) */
  .footer-note{ text-align:center; margin:18px 0 28px; font-size:14px; line-height:1.4; }
  .thanks{ display:block; color:var(--sage-900); font-weight:600; }
  .feedback{ display:block; color:var(--sage-900); }
  /* footer link styling */
  .footer-note a{ color:var(--sage-900); text-decoration:underline; font-weight:400; }

  /* Big green arc (decorative) */
  .arc-bg{
    position: fixed;             /* stays pinned to viewport */
    left: 50%;
    transform: translateX(-50%); /* center it */
    bottom: -35vh;               /* how far it dips below the edge */
    width: 130vw;                /* wider than screen so edges are hidden */
    height: 60vh;                /* arc height */
    border-radius: 50% 50% 0 0 / 100% 100% 0 0; /* top is a half-ellipse */
    background: var(--pale);     /* your pale green */
    z-index: -1;                 /* behind page content */
    pointer-events: none;
  }
</style>
</head>
<body>

  <!-- NAV -->
  <header class="container nav">
    <a class="brand" href="#">AAC Avatar</a>
    <nav class="navlinks" aria-label="Primary">
      <a href="#">Home</a>
      <a href="#">How‚Äìto</a>
      <a href="#">Accessibility</a>
      <a href="#">About Us</a>
    </nav>
    <div class="nav-actions">
      <button class="avatar-btn" aria-label="Profile / Lock">üîí</button>
    </div>
  </header>

  <!-- TITLE -->
  <section class="container hero">
    <h1>An avatar to build your voice.</h1>
  </section>



  <!-- GREEN PANEL -->
  <section class="container panel" aria-label="Avatar and quick phrases">
    <div class="frame">
      <!-- re add the "src="your-video.mp4" part-->
      <video class="screen" id="screen-box" poster="poster.jpg" controls></video>
      <!-- Or: <img class="screen" src="your-image.jpg" alt="Avatar"> -->
    </div>

    <div id="keys-container" class="keys"></div>

<div class="sentence-area" style="margin-top:14px;">
  <div id="sentence-field" 
       style="background:#fff;border:2px solid #ccc;border-radius:8px;padding:10px;
              min-height:40px;font-size:16px;">
  </div>
  <!-- Type area: user-typed message -->
  <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
    <label for="type-input" class="visually-hidden">Type message</label>
    <input id="type-input" type="text" placeholder="Type message..." style="flex:1; padding:8px 10px; border-radius:6px; border:1px solid #ccc;" />
    <button id="add-speak" type="button" style="background:#7f8f73;color:white;border:none;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer;">Add & Speak</button>
  </div>

  <div style="margin-top:10px;display:flex;gap:10px;">
    <button id="speak-sentence" 
            style="background:#7f8f73;color:white;border:none;padding:10px 16px;
                   border-radius:8px;font-weight:600;cursor:pointer;">Speak Sentence</button>
    <button id="clear-sentence" 
            style="background:#ccc;color:#000;border:none;padding:10px 16px;
                   border-radius:8px;font-weight:600;cursor:pointer;">Clear</button>
  </div>
</div>

    <!-- Finder: search across all vocabulary -->
    <div class="finder" style="margin:12px 0 8px; display:flex; gap:8px; align-items:center;">
      <label for="finder-input" style="font-weight:600; font-size:13px;">Finder</label>
      <input id="finder-input" type="text" placeholder="Search words..." style="flex:1; padding:8px 10px; border-radius:6px; border:1px solid #ccc;" />
      <button id="finder-search" type="button" style="background:#7f8f73;color:white;border:none;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer;">Search</button>
    </div>

  </section>

  <!-- LOWER CONTENT removed to simplify UI -->

  <!-- FOOTER -->
    <footer class="container footer-note">
      <span class="thanks">Thanks for trying our tool!</span>
      <span class="feedback"> <a href="#">Share your feedback</a> to help us improve.</span>
    </footer>

  <!-- Accessible live region + behavior for buttons -->
  <div id="speech-status" class="visually-hidden" aria-live="polite"></div>

  <script>
    (function(){
      // Speak the button label using the Web Speech API
      const synth = window.speechSynthesis;
      const status = document.getElementById('speech-status');

      function speak(text){
        if(!synth){
          status.textContent = text;
          return;
        }
        try{ synth.cancel(); }catch(e){}
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'en-US';
        u.rate = 0.95;
        u.pitch = 1;
        u.onstart = ()=> { status.textContent = 'Speaking: ' + text; };
        u.onend = ()=> { status.textContent = ''; };
        synth.speak(u);
      }

      // Navigation state
      let currentPage = 'home';

      // Home screen buttons (4√ó4 grid)
      const homeScreenButtons = [
        { label: "I", isFolder: false },
        { label: "Want", isFolder: false },
        { label: "Help", isFolder: false },
        { label: "More", isFolder: false },
        { label: "Go", isFolder: false },
        { label: "Stop", isFolder: false },
        { label: "Look", isFolder: false },
        { label: "Like", isFolder: false },
        { label: "Yes", isFolder: false },
        { label: "No", isFolder: false },
        { label: "Feelings", isFolder: true },
        { label: "People", isFolder: true },
        { label: "Food", isFolder: true },
        { label: "Play / Toys", isFolder: true },
        { label: "Places", isFolder: true },
        { label: "Actions", isFolder: true }
      ];

      // Folder content (each has 15 vocabulary items so Back + 15 = 16 keys)
      const folderContent = {
        "Feelings": [
          "Happy","Sad","Angry","Tired","Excited",
          "Scared","Worried","Calm","Silly","Frustrated",
          "Proud","Lonely","Confused","Hurt","Bored"
        ],
        "People": [
          "Me","Mom","Dad","Brother","Sister",
          "Baby","Friend","Teacher","Class","Nurse",
          "Doctor","Therapist","Grandma","Grandpa","Pet"
        ],
        "Food": [
          "Eat","Drink","Water","Milk","Juice",
          "Snack","Breakfast","Lunch","Dinner","Fruit",
          "Vegetable","Cookie","Pizza","Chips","Candy"
        ],
        "Play / Toys": [
          "Play","Toy","Ball","Book","Music",
          "Tablet","Game","TV","Phone","Blocks",
          "Doll","Car","Puzzle","Swing","Slide"
        ],
        "Places": [
          "Home","School","Outside","Bathroom","Kitchen",
          "Bedroom","Classroom","Playground","Store","Restaurant",
          "Car","Bus","Park","Doctor","Grandma house"
        ],
        "Actions": [
          "Want","Need","Help","Go","Stop",
          "Look","Come","Turn","Open","Close",
          "Sit","Stand","Wait","Talk","Read"
        ]
      };

      // DOM elements
      const keysContainer = document.getElementById('keys-container');
      const sentenceField = document.getElementById('sentence-field');
      const speakSentenceBtn = document.getElementById('speak-sentence');
      const clearSentenceBtn = document.getElementById('clear-sentence');
      const finderInput = document.getElementById('finder-input');
      const finderSearchBtn = document.getElementById('finder-search');
      const typeInput = document.getElementById('type-input');
      const addSpeakBtn = document.getElementById('add-speak');

      // --- Add word to sentence ---
      function addToSentence(word) {
        sentenceField.textContent += (sentenceField.textContent ? ' ' : '') + word;
      }

      // --- Render home screen (4√ó4) ---
      function renderHome() {
        currentPage = 'home';
        keysContainer.innerHTML = '';
        // ensure 4x4 grid
        keysContainer.style.gridTemplateColumns = 'repeat(4, minmax(0, 1fr))';
        homeScreenButtons.forEach(buttonConfig => {
          const btn = document.createElement('button');
          btn.className = 'key';
          if (buttonConfig.isFolder) {
            btn.classList.add('folder');
          }
          btn.textContent = buttonConfig.label;
          btn.setAttribute('type', 'button');

          btn.addEventListener('click', () => {
            if (buttonConfig.isFolder) {
              openFolder(buttonConfig.label);
            } else {
              addToSentence(buttonConfig.label);
              speak(buttonConfig.label);
            }
          });

          btn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              btn.click();
            }
          });

          keysContainer.appendChild(btn);
        });
      }

      // --- Open folder page ---
      function openFolder(folderName) {
        currentPage = folderName;
        keysContainer.innerHTML = '';
        // enforce 4x4 layout for folder pages
        keysContainer.style.gridTemplateColumns = 'repeat(4, minmax(0, 1fr))';
        const words = folderContent[folderName] || [];

        // Add Back button
        const backBtn = document.createElement('button');
        backBtn.className = 'key back';
        backBtn.textContent = '‚Üê Back';
        backBtn.setAttribute('type', 'button');
        backBtn.addEventListener('click', () => {
          renderHome();
        });
        backBtn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            backBtn.click();
          }
        });
        keysContainer.appendChild(backBtn);

        // Add folder words
        words.forEach(word => {
          const btn = document.createElement('button');
          btn.className = 'key';
          btn.textContent = word;
          btn.setAttribute('type', 'button');

          btn.addEventListener('click', () => {
            addToSentence(word);
            speak(word);
          });

          btn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              btn.click();
            }
          });

          keysContainer.appendChild(btn);
        });
      }

      // --- Render search results (flat) ---
      function renderSearchResults(query) {
        const q = (query || '').trim().toLowerCase();
        keysContainer.innerHTML = '';
        keysContainer.style.gridTemplateColumns = 'repeat(4, minmax(0, 1fr))';

        // Back button returns to previous page
        const backBtn = document.createElement('button');
        backBtn.className = 'key back';
        backBtn.textContent = '‚Üê Back';
        backBtn.setAttribute('type', 'button');
        backBtn.addEventListener('click', () => {
          if (currentPage === 'home') renderHome(); else openFolder(currentPage);
        });
        backBtn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); backBtn.click(); }
        });
        keysContainer.appendChild(backBtn);

        if (!q) {
          // if empty query, show home (just return)
          return;
        }

        // collect matches from home labels and folder words
        const matches = [];
        homeScreenButtons.forEach(b => {
          if (b.label.toLowerCase().includes(q)) matches.push(b.label);
        });
        Object.keys(folderContent).forEach(folder => {
          folderContent[folder].forEach(word => {
            if (word.toLowerCase().includes(q)) matches.push(word);
          });
        });

        if (matches.length === 0) {
          const noKey = document.createElement('div');
          noKey.className = 'key';
          noKey.textContent = 'No matches';
          noKey.setAttribute('role', 'note');
          noKey.style.opacity = '0.6';
          keysContainer.appendChild(noKey);
          return;
        }

        matches.forEach(m => {
          const btn = document.createElement('button');
          btn.className = 'key';
          btn.textContent = m;
          btn.setAttribute('type', 'button');
          btn.addEventListener('click', () => { addToSentence(m); speak(m); });
          btn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });
          keysContainer.appendChild(btn);
        });
      }

      // --- Finder wiring ---
      finderSearchBtn.addEventListener('click', () => {
        renderSearchResults(finderInput.value || '');
      });
      finderInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          renderSearchResults(finderInput.value || '');
        }
      });

      // --- Type (Add & Speak) wiring ---
      function handleAddSpeak() {
        const text = (typeInput.value || '').trim();
        if (!text) return;
        addToSentence(text);
        speak(text);
        typeInput.value = '';
        typeInput.focus();
      }
      addSpeakBtn.addEventListener('click', handleAddSpeak);
      typeInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleAddSpeak(); } });

      // --- Speak full sentence ---
      speakSentenceBtn.addEventListener('click', async () => {
        const text = sentenceField.textContent.trim();
        if (!text) return;
        speak(text);
        await queryGemini(text);
        sentenceField.textContent = "";
      });

      // --- Clear sentence ---
      clearSentenceBtn.addEventListener('click', () => {
        sentenceField.textContent = '';
      });

      // --- queryGemini: Send sentence to Gemini API ---
      async function queryGemini(sentence) {
        try {
          const res = await fetch("http://127.0.0.1:5000/api/gemini", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: sentence }),
          });

          const data = await res.json();
          const reply = data.reply || "No response from Gemini.";
          console.log("Gemini reply:", reply);

          // Speak the reply
          const synth = window.speechSynthesis;
          if (synth) {
            const utter = new SpeechSynthesisUtterance(reply);
            utter.lang = "en-US";
            utter.rate = 1;
            synth.cancel();
            synth.speak(utter);
          }

          // Display in frame
          const frame = document.querySelector(".frame");
          const screen = document.getElementById("screen-box");
          screen.style.display = "none";

          let textBox = document.getElementById("gemini-output");
          if (!textBox) {
            textBox = document.createElement("div");
            textBox.id = "gemini-output";
            frame.appendChild(textBox);
          }

          textBox.innerHTML = reply;
          textBox.style.cssText = `
            width: 100%;
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: rgba(0,0,0,0.7);
            color: white;
            font-size: 18px;
            padding: 20px;
            border-radius: 12px;
            position: relative;
            overflow-y: auto;
          `;
        } catch (error) {
          console.error("Gemini API error:", error);
        }
      }


      // Initialize home screen
      renderHome();

    })();
  </script>

<div class="arc-bg" aria-hidden="true"></div>

</body>
</html>
